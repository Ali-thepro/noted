image: node:23.6.0

stages:
  - lint
  - test

cache:
  key: backend-cache
  paths:
    - code/backend/node_modules/

before_script:
  - cd code/backend
  - npm install

lint:
  stage: lint
  script:
    - npm run lint

test:
  image: node:23.6.0
  variables:
    NODE_ENV: "test"
    TEST_MONGODB_URI: "${TEST_MONGODB_URI}"
    MONGODB_URI: "${MONGODB_URI}"
  script:
    - echo "NODE_ENV is $NODE_ENV"
    - echo "TEST_MONGODB_URI is set: $([[ ! -z $TEST_MONGODB_URI ]] && echo 'true' || echo 'false')"
    - cd code/backend
    - npm install
    - npm run test
